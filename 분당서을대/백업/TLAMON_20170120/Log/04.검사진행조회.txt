Select DISTINCT a.BCD,a.PNM,(a.SEX +'/'+ a.AGE) as SA,a.ADTM,b.EQPCD,b.STA, a.STA as ASTA, '1' as SEQ, (Select 'ERR' from TB_Event Where BCD = a.BCD and AREA = 'Er') as ERR  From SNUBH_TLA..TB_BCD a, SNUBH_TLA..TB_EVENT b  Where a.BCD = b.BCD   And b.INDTM between '20170118000000' and '20170118235959'   And b.EQPCD IN ('ARC','ARC1','ARC2','AU','AU1','AU2','COB')   And b.STA = 'O'   And b.SEQ IN (Select MAX(SEQ)                   From SNUBH_TLA..TB_EVENT                   Where EQPCD IN ('ARC','ARC1','ARC2','AU','AU1','AU2','COB')                    And INDTM between '20170118000000' and '20170118235959'                    And BCD = b.BCD                     And GRPCD = b.GRPCD                     And EQPCD = b.EQPCD                   Group By BCD, EQPCD) and a.STA = 'H' Union All Select DISTINCT a.BCD,a.PNM,(a.SEX +'/'+ a.AGE) as SA,a.ADTM,b.EQPCD,b.STA, a.STA as ASTA, '2' as SEQ, (Select 'ERR' from TB_Event Where BCD = a.BCD and AREA = 'Er') as ERR  From SNUBH_TLA..TB_BCD a, SNUBH_TLA..TB_EVENT b  Where a.BCD = b.BCD   And b.INDTM between '20170118000000' and '20170118235959'   And b.EQPCD IN ('ARC','ARC1','ARC2','AU','AU1','AU2','COB')   And b.STA = 'R'   And b.SEQ IN (Select MAX(SEQ)                   From SNUBH_TLA..TB_EVENT                   Where EQPCD IN ('ARC','ARC1','ARC2','AU','AU1','AU2','COB')                    And INDTM between '20170118000000' and '20170118235959'                    And BCD = b.BCD                     And GRPCD = b.GRPCD                     And EQPCD = b.EQPCD                   Group By BCD, EQPCD) and a.STA = 'H' Union All Select DISTINCT a.BCD,a.PNM,(a.SEX +'/'+ a.AGE) as SA,a.ADTM,b.EQPCD,b.STA, a.STA as ASTA, '3' as SEQ, (Select 'ERR' from TB_Event Where BCD = a.BCD and AREA = 'Er') as ERR  From SNUBH_TLA..TB_BCD a, SNUBH_TLA..TB_EVENT b  Where a.BCD = b.BCD   And b.INDTM between '20170118000000' and '20170118235959'   And b.EQPCD IN ('ARC','ARC1','ARC2','AU','AU1','AU2','COB')   And b.STA = 'OO'   And b.SEQ IN (Select MAX(SEQ)                   From SNUBH_TLA..TB_EVENT                   Where EQPCD IN ('ARC','ARC1','ARC2','AU','AU1','AU2','COB')                    And INDTM between '20170118000000' and '20170118235959'                    And BCD = b.BCD                     And GRPCD = b.GRPCD                     And EQPCD = b.EQPCD                   Group By BCD, EQPCD) and a.STA = 'H' Union All Select DISTINCT a.BCD,a.PNM,(a.SEX +'/'+ a.AGE) as SA,a.ADTM,b.EQPCD,b.STA, a.STA as ASTA, '4' as SEQ, (Select 'ERR' from TB_Event Where BCD = a.BCD and AREA = 'Er') as ERR  From SNUBH_TLA..TB_BCD a, SNUBH_TLA..TB_EVENT b  Where a.BCD = b.BCD   And b.INDTM between '20170118000000' and '20170118235959'   And b.EQPCD IN ('ARC','ARC1','ARC2','AU','AU1','AU2','COB')   And b.STA = 'RR'   And b.SEQ IN (Select MAX(SEQ)                   From SNUBH_TLA..TB_EVENT                   Where EQPCD IN ('ARC','ARC1','ARC2','AU','AU1','AU2','COB')                    And INDTM between '20170118000000' and '20170118235959'                    And BCD = b.BCD                     And GRPCD = b.GRPCD                     And EQPCD = b.EQPCD                   Group By BCD, EQPCD) and a.STA = 'H' Order By a.ADTM DESC,a.BCD ASC,SEQ, b.STA DESC, b.EQPCD ASC 
