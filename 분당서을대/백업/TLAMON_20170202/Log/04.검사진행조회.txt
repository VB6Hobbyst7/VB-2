Select DISTINCT a.BCD,a.PNM,(a.SEX +'/'+ a.AGE) as SA,a.ADTM,b.EQPCD,b.STA, a.STA as ASTA, '1' as SEQ, a.PID, a.WORKNO, (Select top 1 'ERR' From SNUBH_TLA..TB_Event Where BCD = a.BCD and AREA = 'Er') as ERR  From SNUBH_TLA..TB_BCD a, SNUBH_TLA..TB_EVENT b  Where a.BCD = b.BCD   And (a.ODYYN IS NOT NULL AND a.ODYYN <> '' OR a.QUICKYN IS NOT NULL AND a.QUICKYN <> '' )    And b.INDTM between '20170118000000' and '20170201235959'   And b.EQPCD IN ('ARC','ARC1','ARC2','AU','AU1','AU2','COB')   And b.STA = 'O'   And a.STA <> 'H'   And b.SEQ IN (Select MAX(SEQ)                   From SNUBH_TLA..TB_EVENT                   Where EQPCD IN ('ARC','ARC1','ARC2','AU','AU1','AU2','COB')                    And INDTM between '20170118000000' and '20170201235959'                    And BCD = b.BCD                     And GRPCD = b.GRPCD                     And EQPCD = b.EQPCD                   Group By BCD, EQPCD) Union All Select DISTINCT a.BCD,a.PNM,(a.SEX +'/'+ a.AGE) as SA,a.ADTM,b.EQPCD,b.STA, a.STA as ASTA, '2' as SEQ, a.PID, a.WORKNO, (Select top 1 'ERR' From SNUBH_TLA..TB_Event Where BCD = a.BCD and AREA = 'Er') as ERR  From SNUBH_TLA..TB_BCD a, SNUBH_TLA..TB_EVENT b  Where a.BCD = b.BCD   And (a.ODYYN IS NOT NULL AND a.ODYYN <> '' OR a.QUICKYN IS NOT NULL AND a.QUICKYN <> '' )    And b.INDTM between '20170118000000' and '20170201235959'   And b.EQPCD IN ('ARC','ARC1','ARC2','AU','AU1','AU2','COB')   And b.STA = 'R'   And a.STA <> 'H'   And b.SEQ IN (Select MAX(SEQ)                   From SNUBH_TLA..TB_EVENT                   Where EQPCD IN ('ARC','ARC1','ARC2','AU','AU1','AU2','COB')                    And INDTM between '20170118000000' and '20170201235959'                    And BCD = b.BCD                     And GRPCD = b.GRPCD                     And EQPCD = b.EQPCD                   Group By BCD, EQPCD) Union All Select DISTINCT a.BCD,a.PNM,(a.SEX +'/'+ a.AGE) as SA,a.ADTM,b.EQPCD,b.STA, a.STA as ASTA, '3' as SEQ, a.PID, a.WORKNO, (Select top 1 'ERR' From SNUBH_TLA..TB_Event Where BCD = a.BCD and AREA = 'Er') as ERR  From SNUBH_TLA..TB_BCD a, SNUBH_TLA..TB_EVENT b  Where a.BCD = b.BCD   And (a.ODYYN IS NOT NULL AND a.ODYYN <> '' OR a.QUICKYN IS NOT NULL AND a.QUICKYN <> '' )    And b.INDTM between '20170118000000' and '20170201235959'   And b.EQPCD IN ('ARC','ARC1','ARC2','AU','AU1','AU2','COB')   And b.STA = 'OO'   And a.STA <> 'H'   And b.SEQ IN (Select MAX(SEQ)                   From SNUBH_TLA..TB_EVENT                   Where EQPCD IN ('ARC','ARC1','ARC2','AU','AU1','AU2','COB')                    And INDTM between '20170118000000' and '20170201235959'                    And BCD = b.BCD                     And GRPCD = b.GRPCD                     And EQPCD = b.EQPCD                   Group By BCD, EQPCD) Union All Select DISTINCT a.BCD,a.PNM,(a.SEX +'/'+ a.AGE) as SA,a.ADTM,b.EQPCD,b.STA, a.STA as ASTA, '4' as SEQ, a.PID, a.WORKNO, (Select top 1 'ERR' From SNUBH_TLA..TB_Event Where BCD = a.BCD and AREA = 'Er') as ERR  From SNUBH_TLA..TB_BCD a, SNUBH_TLA..TB_EVENT b  Where a.BCD = b.BCD   And (a.ODYYN IS NOT NULL AND a.ODYYN <> '' OR a.QUICKYN IS NOT NULL AND a.QUICKYN <> '' )    And b.INDTM between '20170118000000' and '20170201235959'   And b.EQPCD IN ('ARC','ARC1','ARC2','AU','AU1','AU2','COB')   And b.STA = 'RR'   And a.STA <> 'H'   And b.SEQ IN (Select MAX(SEQ)                   From SNUBH_TLA..TB_EVENT                   Where EQPCD IN ('ARC','ARC1','ARC2','AU','AU1','AU2','COB')                    And INDTM between '20170118000000' and '20170201235959'                    And BCD = b.BCD                     And GRPCD = b.GRPCD                     And EQPCD = b.EQPCD                   Group By BCD, EQPCD) Order By a.ADTM, a.BCD ASC,SEQ, b.STA DESC, b.EQPCD ASC 
