Select DISTINCT        (a.진료년 + a.진료월 + a.진료일)    AS HOSPDATE     
     , a.챠트번호                          AS CHARTNO      
     , b.수진자명                          AS PNAME        
     , b.주민등록번호                      AS PJUMIN       
     , COUNT(a.처방코드)                   AS CNT          
  From TB_검사항목 a                                       
     , TB_인적사항 b                                       
     , TB_진료기본 c                                       
 Where (a.진료년 + a.진료월 + a.진료일) >= '20190727' 
   And (a.진료년 + a.진료월 + a.진료일) <= '20190727'   
   And a.처방번호 > 0                                      
   And c.진료상태 IN ('1','5','6','7','8','9')             
   And (a.처방코드 + '|' + a.서브코드) IN ('D1860|01','D1860|01','D1850|01','D1870|01','D2263|01','D1890|01','D3022A|01','D3022|01','D2611|01','D2300|01','D2280|01','D2310|01','D1840|01','D1880|01','D1830|01','D2613|01','D0113|01','D7813|01','CZ246|01','D7811|01')   
   And (a.검사결과 IS NULL OR a.검사결과 = '')             
   And a.진료년    = c.진료년                              
   And a.진료월    = c.진료월                              
   And a.진료일    = c.진료일                              
   And a.챠트번호  = c.챠트번호                            
   And a.챠트번호  = b.챠트번호                            
   And (a.검사결과 IS NULL OR a.검사결과 = '')             
 GROUP BY HOSPDATE, a.챠트번호, b.수진자명, b.주민등록번호 
 Order By a.진료년, a.진료월, a.진료일, b.수진자명         

