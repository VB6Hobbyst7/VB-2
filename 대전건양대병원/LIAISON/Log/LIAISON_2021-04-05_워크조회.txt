SELECT DISTINCT        a.챠트번호          AS  CHARTNO 
     , a.진료년            AS  HOSPYY  
     , a.진료월            AS  HOSPMM  
     , a.진료일            AS  HOSPDD  
     , b.수진자명          AS  PNAME   
     , b.주민등록번호      AS  JUMIN   
     , COUNT(a.처방코드)     AS  COUNT   
  FROM TB_검사항목 a                   
     , TB_인적사항 b                   
     , tb_진료기본 c                   
     , tb_진료내역 d                   
 WHERE a.진료년 Between '2021' And '2021'    
   And a.진료월 Between '04' And '04'    
   And a.진료일 Between '05' And '05'    
   And a.처방번호 > 0                                          
   And c.진료상태 in( '1','5','7','8')                 
   And a.처방코드 + '|' + a.서브코드 IN ('2208201','310149','320126','320127','320128','320130','320133','320134','320135','320136','320137','320138','320139','320140','32014001','32014002','32014003','32014004','32014005','32014006','320141','3201411','320142','320144','320145','320146','320147','320210','320211','320243','420804')         
   And (a.검사결과 is null or a.검사결과 = '')                 
   And d.수정구분 <> '1'                                       
   And a.진료년    = c.진료년          
   And a.진료월    = c.진료월          
   And a.진료일    = c.진료일          
   And a.챠트번호  = c.챠트번호        
   And a.챠트번호  = b.챠트번호        
   And a.진료년    = d.진료년          
   And a.진료월    = d.진료월          
   And a.진료일    = d.진료일          
   And a.챠트번호  = d.챠트번호        
   And a.처방코드  = d.처방코드        
 GROUP BY a.챠트번호, a.진료년, a.진료월, a.진료일, b.수진자명, b.주민등록번호 
 Order By a.진료년, a.진료월, a.진료일, b.수진자명 

