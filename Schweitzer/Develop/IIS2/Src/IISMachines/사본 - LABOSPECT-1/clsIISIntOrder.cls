VERSION 1.0 CLASS
BEGIN
  MultiUse = -1  'True
  Persistable = 0  'NotPersistable
  DataBindingBehavior = 0  'vbNone
  DataSourceBehavior  = 0  'vbNone
  MTSTransactionMode  = 0  'NotAnMTSObject
END
Attribute VB_Name = "clsIISIntOrder"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = False
Attribute VB_Exposed = True
'-----------------------------------------------------------------------------'
'   파일명  : clsIISIntOrder.cls
'   작성자  : 이상대
'   내  용  : Hitachi 7600 장비 오더정보 클래스
'   작성일  : 2004-10-07
'   버  전  :
'-----------------------------------------------------------------------------'

Option Explicit

Private mAccInfo    As clsIISAccInfo   '접수내역 클래스

Private mBarNo      As String   '바코드번호
Private mSmplNo     As String   '샘플번호
Private mSpcType    As String   '검체유형
Private mRackNo     As String   'Rack No
Private mPos        As String   'Position
Private mRackType   As String   'RackType
Private mContType   As String   'ContType

Private mKind       As String   'Run(R1), Rerun(R2), QC(Q) 구분
Private mPriority   As String   '응급구분(R:Routine, S:Stat)
Private mOrder      As String   '오더 전송후 남은오더
Private mNoOrder    As Boolean  '접수정보 존재유무 (True:비존재, False:존재)

Public Property Get AccInfo() As clsIISAccInfo
    Set AccInfo = mAccInfo
End Property

Public Property Let AccInfo(ByVal vData As clsIISAccInfo)
    Set mAccInfo = vData
End Property

Public Property Get BarNo() As String
    BarNo = mBarNo
End Property

Public Property Let BarNo(ByVal vData As String)
    mBarNo = vData
End Property

Public Property Get SmplNo() As String
    SmplNo = mSmplNo
End Property

Public Property Let SmplNo(ByVal vData As String)
    mSmplNo = vData
End Property

Public Property Get SpcType() As String
    SpcType = mSpcType
End Property

Public Property Let SpcType(ByVal vData As String)
    mSpcType = vData
End Property

Public Property Get RackNo() As String
    RackNo = mRackNo
End Property

Public Property Let RackNo(ByVal vData As String)
    mRackNo = vData
End Property

Public Property Get Pos() As String
    Pos = mPos
End Property

Public Property Let Pos(ByVal vData As String)
    mPos = vData
End Property

Public Property Get RackType() As String
    RackType = mRackType
End Property

Public Property Let RackType(ByVal vData As String)
    mRackType = vData
End Property

Public Property Get ContType() As String
    ContType = mContType
End Property

Public Property Let ContType(ByVal vData As String)
    mContType = vData
End Property

Public Property Get Kind() As String
    Kind = mKind
End Property

Public Property Let Kind(ByVal vData As String)
    mKind = vData
End Property

Public Property Get Priority() As String
    Priority = mPriority
End Property

Public Property Let Priority(ByVal vData As String)
    mPriority = vData
End Property

Public Property Get Order() As String
    Order = mOrder
End Property

Public Property Let Order(ByVal vData As String)
    mOrder = vData
End Property

Public Property Get NoOrder() As Boolean
    NoOrder = mNoOrder
End Property

Public Property Let NoOrder(ByVal vData As Boolean)
    mNoOrder = vData
End Property

'-----------------------------------------------------------------------------'
'   기능 : 오더정보 문자열을 조회
'   반환 : 오더정보 문자열
'-----------------------------------------------------------------------------'
Public Function GetOrder() As String
    Dim objResult   As clsIISResult     '결과내역 클래스
    Dim objQCResult As clsIISQCResult   'QC결과내역 클래스
    Dim objIntNm    As clsIISIntNm      '장비별 검사항목 클래스
    Dim strIntBase  As String           '장비기준 검사명
    Dim strItems    As String           '전송할 검사항목
    Dim blnISE      As Boolean          'ISE모듈 검사항목 유무
    Dim blnRPR      As Boolean
    
    blnRPR = False
    
    '## 오더문자열 형식: ^^^1/\^^^2
    If mAccInfo.QcFg = "0" Then
        For Each objResult In mAccInfo.Results
            Set objIntNm = objResult.IntNm
            strIntBase = objIntNm.IntBase
            'Call mIntLib.WriteLog(strIntBase & ",", ccEqp)
            
            If Right(strIntBase, 1) = "N" Or Right(strIntBase, 1) = "C" Then
                strIntBase = Mid(strIntBase, 1, Len(strIntBase) - 1)
            End If
            
            
            'If blnRPR = False Then
                If strItems = "" Then
                    strItems = "^^^" & strIntBase & "^"
                Else
                    If InStr(strItems, strIntBase) <= 0 Then
                        strItems = strItems & "\^^^" & strIntBase & "^"
                    End If
                End If
            'End If
            
            'LDL : LDL(cal) 962 오더를 같이준다.
            '==> 결과는 나오지 않음
            If strIntBase = "28013" Then
                strItems = strItems & "\^^^962^"
            End If
            
            'RPR
'            If strIntBase = "28073" Then
'                blnRPR = True
'            End If
        Next
        
        Set objResult = Nothing
    ElseIf mAccInfo.QcFg = "1" Then
        For Each objQCResult In mAccInfo.QCResults
            Set objIntNm = objQCResult.IntNm
            strIntBase = objIntNm.IntBase
            
            If Right(strIntBase, 1) = "N" Or Right(strIntBase, 1) = "C" Then
                strIntBase = Mid(strIntBase, 1, Len(strIntBase) - 1)
            End If
            
            'If blnRPR = False Then
                If strItems = "" Then
                    strItems = "^^^" & strIntBase & "^"
                Else
                    If InStr(strItems, strIntBase) <= 0 Then
                        strItems = strItems & "\^^^" & strIntBase & "^"
                    End If
                End If
            'End If
            
            'LDL : LDL(cal) 962 오더를 같이준다.
            '==> 결과는 나오지 않음
            If strIntBase = "28013" Then
                strItems = strItems & "\^^^962^"
            End If
'            'RPR
'            If strIntBase = "28073" Then
'                blnRPR = True
'            End If
            
        Next
        
        Set objQCResult = Nothing
    End If
    Set objIntNm = Nothing

    GetOrder = strItems
End Function

'-----------------------------------------------------------------------------'
'   기능 : 검체유형을 조회
'   반환 : 검체유형
'-----------------------------------------------------------------------------'
'Public Function GetSpcType() As String
''
'End Function

'-----------------------------------------------------------------------------'
'   기능 : 응급유무 조회
'   반환 : 응급유무
'-----------------------------------------------------------------------------'
'Public Function GetStatFg() As String
''
'End Function

'-----------------------------------------------------------------------------'
'   기능 : 해당 문자열의 CheckSum을 구함
'   인수 :
'       - pMsg : 문자열
'   반환 : CheckSum
'-----------------------------------------------------------------------------'
Public Function GetChkSum(ByVal pMsg As String) As String
    Dim lngChkSum   As Long
    Dim i           As Long

    For i = 1 To Len(pMsg)
        lngChkSum = (lngChkSum + Asc(Mid(pMsg, i, 1))) Mod 256
    Next

    If lngChkSum = 0 Then
        GetChkSum = "00"
    Else
        GetChkSum = Mid("0" & Hex(lngChkSum), Len(Hex(lngChkSum)), 2)
    End If
End Function

'-----------------------------------------------------------------------------'
'   기능 : 클래스 멤버변수 초기화
'-----------------------------------------------------------------------------'
Public Sub ClsClear()
    mBarNo = ""
    mSpcType = ""
    mRackNo = ""
    mPos = ""
    mKind = ""
    mPriority = ""
    mOrder = ""
    mNoOrder = False
    
    Set mAccInfo = Nothing
End Sub

Private Sub Class_Terminate()
    Set mAccInfo = Nothing
End Sub
