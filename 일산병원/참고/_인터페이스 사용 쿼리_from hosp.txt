
<바코드번호로 검체번호 불러오기>

SELECT FN_LABCVTBCNO('바코드번호') FROM DUAL


<조회된 검체번호로 해당 환자정보 및 검사코드 조회>

SELECT B.WORK_NO, A.PID, A.PT_NM, B.EXMN_CD
  FROM SPSLMJBBI A, SPSLHRRST B
 WHERE A.SPCM_NO = B.SPCM_NO
   AND A.SPCM_NO = '검체번호'
   AND B.RSLT_STAT < 2
   AND B.EXMN_CD IN ('검사코드')
 ORDER BY B.EXMN_CD



<검사횟수 카운트 불러옴>

SELECT RSLT_NO 
  FROM SPSLHRRST
 WHERE SPCM_NO = '검체번호'
   AND EXMN_CD = '검사코드'


<Group 코드 찾기>

SELECT DISTINCT R1.PRSC_CD ,NVL(R1.RSLT_STAT, '0') RSLT_FLAG
  FROM SPSLHRRST R1, SPSLMFBIF F1
 WHERE R1.EXMN_CD = F1.EXMN_CD
   AND R1.RCPN_DT >= F1.USE_STR_DY
   AND R1.RCPN_DT <  F1.USE_END_DY
   AND R1.SPCM_NO = '검체번호'
   AND R1.EXMN_CD = '검사코드'
   AND R1.PRSC_CD LIKE ('%G%') 
 GROUP BY R1.PRSC_CD, R1.RSLT_STAT 


<멀티 코드 찾기>

SELECT DISTINCT R1.PRSC_CD ,NVL(R1.RSLT_STAT, '0') RSLT_FLAG
  FROM SPSLHRRST R1, SPSLMFBIF F1
 WHERE R1.EXMN_CD = F1.EXMN_CD
   AND R1.RCPN_DT >= F1.USE_STR_DY
   AND R1.RCPN_DT <  F1.USE_END_DY
   AND R1.SPCM_NO = '검체번호'
   AND R1.EXMN_CD = '검사코드'
   AND F1.CD_DVSN = 'M'
 GROUP BY R1.PRSC_CD, R1.RSLT_STAT 

                  
<밧데리 코드 찾기>

SELECT DISTINCT R1.PRSC_CD ,NVL(R1.RSLT_STAT, '0') RSLT_FLAG
  FROM SPSLHRRST R1, SPSLMFBIF F1
 WHERE R1.EXMN_CD = F1.EXMN_CD
   AND R1.RCPN_DT >= F1.USE_STR_DY
   AND R1.RCPN_DT <  F1.USE_END_DY
   AND R1.SPCM_NO = '검체번호'
   AND R1.EXMN_CD = '검사코드'
   AND F1.CD_DVSN = 'B'
 GROUP BY R1.PRSC_CD, R1.RSLT_STAT 


<처방 상태 업데이트시 (내부 Select 부분)>

UPDATE MDMDHTORD 
   SET PRSC_STAT = '50'      '/50 예비보고, 51 최종보고
     , RPTG_DT = SYSDATE
     , AMEN_ID = 'NHIMC_INF'
  FROM MDMDHTORD
 WHERE (PRSC_SQNO, PRSC_CD) 
       IN (SELECT PRSC_SQNO, EXMN_CD 
             FROM SPSLMJBDI 
            WHERE SPCM_NO = '검체번호' 
              AND EXMN_CD IN ('검사코드1','검사코드2','검사코드3') 
              AND SPCM_STAT = '2') 
AND DC_DVSN = 'O' 
AND PRSC_STAT < '50'